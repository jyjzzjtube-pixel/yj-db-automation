# 🏢 YJ Partners 프랜차이즈 통합 DB 자동화 - 서버 전환 프로젝트

## 📋 프로젝트 개요

프랜차이즈 창업 컨설팅 회사(YJ Partners)의 업무 자동화 시스템.
현재 HTML 단일파일 앱(PC/모바일 각 1개)을 **서버 기반 웹앱**으로 전환한다.

### 현재 상태
- PC용: `DB자동화.html` (960줄)
- 모바일용: `DB자동화_모바일.html` (950줄)
- 저장: localStorage (브라우저별 독립, 동기화 안됨)
- 파일: base64로 localStorage에 저장 (5MB 제한)

### 전환 목표
- **서버 앱 1개** (PC/모바일 반응형 통합)
- **DB**: PostgreSQL (데이터 영구 저장)
- **파일 스토리지**: 서버 로컬 or S3 (용량 무제한)
- **로그인**: 관리자(전체권한) + 직원(열람/입력)
- **동시 사용**: 3~4명
- **배포**: VPS (카페24 or Vultr, 월 3만원 수준)

---

## 🗄️ 데이터 구조

### 1. 고객 (customers)
```json
{
  "id": "uuid",
  "name": "김철수",
  "phone": "010-1234-5678",
  "grade": "VIP",          // VIP, 우수, 일반, 신규, 휴면
  "status": "상담중",       // 신규, 상담중, 제안완료, 계약, 보류, 해지
  "region": "강남",
  "budget": "1억2천만",
  "bizType": "카페",
  "wantArea": "20~35평",
  "interests": "맘스터치, 빽다방",
  "dbCat": "차알 DB",      // 소속 카테고리 (사용자 정의)
  "followUp": "2026-03-01",
  "tags": ["#급매", "#관심높음"],
  "memos": [{"text": "강남 선호", "date": "2026-02-17", "by": "이사"}],
  "consultHistory": [{"date": "2026-02-17", "content": "초기상담", "result": "관심높음"}],
  "activityLog": [{"action": "조회", "date": "2026-02-17 14:30"}],
  "createdAt": "2026-02-17"
}
```

### 2. 점포 (stores)
```json
{
  "id": "uuid",
  "name": "강남역 2번출구",
  "address": "서울 강남구 역삼동 123-4",
  "district": "강남구",
  "floor": "1층",
  "area": "35",              // 평수
  "rent": "350만",           // 임대료(월) - 한글 금액 파싱 필요
  "maintenance": "30만",     // 관리비(월)
  "deposit": "5천만",        // 보증금
  "premium": "8천만",        // 권리금
  "grade": "A급",            // A급, B급, C급, 미정
  "status": "공실",          // 공실, 소개중, 계약진행, 계약완료
  "dbCat": "내일사장DB",     // 소속 카테고리
  "marketRent": "300만",     // 주변 시세(임대)
  "marketDeposit": "4500만", // 주변 시세(보증금)
  "mapQuery": "서울 강남구 역삼동",
  "followUp": "2026-03-01",
  "tags": ["#역세권", "#코너"],
  "photos": [],              // base64 이미지 배열
  "files": [                 // 첨부파일 (PDF, 워드, 한글, 엑셀 등)
    {
      "name": "임대차계약서.pdf",
      "size": 2048000,
      "type": "application/pdf",
      "data": "base64...",   // 서버 전환 시 파일 경로로 변경
      "date": "2026-02-17"
    }
  ],
  "memos": [],
  "activityLog": [],
  "createdAt": "2026-02-17"
}
```

### 3. 브랜드 (brands)
```json
{
  "id": "uuid",
  "brandName": "맘스터치",
  "companyName": "(주)맘스터치앤컴퍼니",
  "contactName": "이부장",
  "position": "부장",
  "phone": "010-5555-1234",
  "consultContent": "가맹조건 문의",
  "tags": [],
  "memos": [],
  "createdAt": "2026-02-17"
}
```

### 4. 카테고리 (사용자 정의)
```json
{
  "custCats": ["차알 DB", "내일사장 DB"],
  "storeCats": ["내일사장DB", "원윌앤코DB", "창업원DB", "황선응 팀장 DB"]
}
```
- 고객/점포 각각 독립 카테고리
- 사용자가 직접 추가/삭제 가능 (텍스트 입력)
- 카테고리별 필터링

### 5. 알리고 SMS 설정
```json
{
  "aligoKey": "API Key",
  "aligoId": "로그인 ID",
  "aligoSender": "01012345678",
  "aligoTest": "Y"           // Y=무료테스트, N=실발송
}
```

---

## ⚡ 핵심 기능 상세

### 1. 스마트 입력 (자동 분류 엔진)

자유 텍스트를 입력하면 자동으로 고객/점포/브랜드로 분류하여 DB에 저장.

**분류 키워드:**
- 점포: `평, 임대, 월세, 보증금, 권리금, 관리비, 공실, 점포, 매물, 상가`
- 브랜드: `본사, 가맹, 프랜차이즈, 브랜드, FC, 창업비용, 로열티, 가맹비`
- 그 외: 고객으로 분류

**고객 자동 파싱:**
- 이름: 한글 2~4글자 (isName 판별)
- 연락처: `010-XXXX-XXXX` 패턴
- 등급: VIP, 우수, 신규, 휴면
- 지역: 강남, 서초, 마포, 송파 등 80개+ 지역
- 업종: 카페, 치킨, 삼겹살, 베이커리 등 80개+ 업종
- 예산: `예산 1억2천만` → 자동 파싱
- 태그: `#급매` `#관심높음` → tags 배열

**점포 자동 파싱:**
- 평수: `35평` → area: "35"
- 임대료: `임대 350만` → rent: "350만"
- 보증금/권리금/관리비: 동일 패턴
- 등급: A급, B급, C급
- 층수: `1층`, `B1`
- 메모 키워드: 코너, 역세권, 대로변, 신축

**브랜드 자동 파싱:**
- 브랜드명: 첫 단어
- 회사명: `(주)xxx`, `주식회사 xxx`
- 담당자: `담당 이부장` → contactName + position
- 창업비용: `창업비용 1억5천만` → consultContent

**입력 예시:**
```
김철수 010-1234-5678 VIP 강남 카페 예산 1억2천만 #급매
강남역 2번출구 35평 임대 350만 관리비 30만 보증금 5천만 A급 #역세권
맘스터치 본사 담당 이부장 010-5555-1234 가맹조건 문의
```
→ 자동분류: 고객 1명 + 점포 1개 + 브랜드 1개 → 미리보기 → 저장

### 2. 한글 금액 파싱 (numVal 함수)

모든 금액 필드에서 한글 금액을 숫자(만원 단위)로 변환:
```
"350만" → 350
"5천만" → 5000
"1억2천만" → 15000 (12000의 오류 아닌지 확인필요 - 1억=10000만 + 2천만=2000만 = 12000만)
"8천만" → 8000
"1억" → 10000
"7820만" → 7820
```
→ 월총비용 계산, 시세비교, 필터링 등에 사용

### 3. 통합 검색

**검색 대상 (고객 13개 필드):**
이름, 연락처, 지역, 업종, 관심사, 예산, 희망평수, 등급, 상태, 소속DB, 태그, 메모 내용, 상담 내역

**검색 대상 (점포 16개 필드):**
점포명, 주소, 지역구, 층수, 평수, 임대료, 관리비, 보증금, 권리금, 등급, 상태, 소속DB, 시세, 태그, 메모 내용

**검색 대상 (브랜드):**
브랜드명, 회사명, 담당자명, 직위, 연락처, 상담내용, 메모

**특징:**
- 대소문자 무시 (toLowerCase)
- 글자 하나라도 매치되면 결과에 포함
- 범위별 검색: 고객/점포/브랜드 선택
- 필드별 검색: 이름, 연락처, 주소, 메모/상담, 등급, 담당자
- 조건 필터: 연락처有, 메모有, 상담有, 사진有, 권리금無
- 기간 필터: 오늘, 7일, 30일, 시작일~종료일
- 정렬: 최신, 오래된, 이름, 임대↑, 임대↓, 평수↓
- 금액 범위: 임대 min~max, 보증금 min~max, 권리금 min~max, 면적 min~max

### 4. 고객 DB

**목록 화면:**
- 검색창 (모든 필드 검색)
- 등급 필터 칩: 전체, VIP, 우수, 일반, 신규, 휴면
- 상태 필터 칩: 전체, 신규, 상담중, 제안완료, 계약, 보류, 해지
- 카테고리 필터 칩: 📂전체, 차알 DB, 내일사장 DB, ...
- 상세필터 (접이식): 지역, 예산 min~max, 업종, 희망평수 min~max
- 체크박스 선택 (전체선택 / 개별)
- 선택 시: 📩 문자(N) + 📱 엑셀(N) 버튼
- 카드: 이름, 등급뱃지, 📂카테고리뱃지, 상태뱃지, 활동뱃지, 연락처, 지역, 업종, 예산, 메모수, 상담수, 팔로업날짜, 태그

**상세 화면:**
- 상단: ← 목록 / No.N / 📩 문자 / 📞 전화 / 삭제
- 기본정보: 이름, 등급(select), 상태(select), 연락처, 팔로업(date)
- 지역, 창업예산, 희망업종, 희망평수
- 관심 브랜드/매물
- 📂 소속 DB (select + "새 카테고리 추가" 옵션)
- 빠른 링크 (네이버, 카카오, 구글)
- 메모 (추가/삭제, 날짜 자동)
- 상담 이력 (날짜, 내용, 결과)
- 활동 로그

**📩 문자 버튼 (1명):**
- 고객 상세에서 바로 클릭 → SMS 모달 열림
- sendOneSMS 함수: 해당 고객 1명 자동 선택 → openSMS

**📞 전화 버튼:**
- `<a href="tel:연락처">` → 모바일에서 터치 시 전화앱 바로 연결

### 5. 점포 DB

**목록 화면:**
- 검색창 (모든 필드 검색)
- 등급 필터: 전체, A급, B급, C급, 미정
- 상태 필터: 전체, 공실, 소개중, 계약진행, 계약완료
- 카테고리 필터: 📂전체, 내일사장DB, 원윌앤코DB, ...
- 상세필터: 지역구, 층수, 임대min~max, 보증min~max, 권리min~max, 면적min~max
- ⚖️ 비교 선택 (체크박스, 2개 이상 선택 시 비교 버튼)
- 카드: 점포명, 등급뱃지, 상태뱃지, 임대/보증/권리/평수, 주소, 시세뱃지(✅시세↓/⚠️시세↑), 📷N 📎N
- 주소 옆 빠른링크: 🏠네이버부동산 📋등기부등본 🗺네이버지도

**상세 화면:**
- 점포명, 등급(select), 상태(select), 팔로업(date)
- 📂 소속 DB
- 주소, 지역구 + 지도/권리확인 버튼 자동 연동
- 층수, 평수, 임대료, 관리비, 보증금, 권리금
- 월총비용 (임대+관리 자동 계산)
- **시세 비교 섹션:**
  - 주변 임대시세 입력
  - 주변 보증금시세 입력
  - 자동 비교: 금액차이 + 퍼센트 + 색상(초록=저렴, 주황=비쌈)
- 📷 사진 (이미지 업로드, 미리보기, 삭제)
- 📎 첨부파일 (PDF/워드/한글/엑셀 등, 열기/다운로드/삭제)
  - 지원: .pdf, .doc, .docx, .xls, .xlsx, .hwp, .hwpx, .ppt, .pptx, .txt, .zip
  - 파일당 10MB 제한 (서버화 시 무제한)
- ☁️ 구글드라이브 (폴더 열기, 전체 다운로드)
- 🗺 지도 (Google Maps iframe embed)
- 🔍 권리 확인 버튼:
  - 🏠 네이버부동산 (주소 검색)
  - 📋 등기부등본 (인터넷등기소)
  - 🏗 건축물대장 (gov.kr)
  - 🗺 토지이용계획 (eum.go.kr)
  - 💰 실거래가 (rt.molit.go.kr)
  - 🏢 사업자확인 (nts.go.kr)
- 메모, 활동로그

### 6. 점포 비교 분석

2개 이상 점포 선택 → ⚖️ 비교:
- 항목별 비교표 (점포명, 주소, 평수, 임대, 보증, 권리, 월총비용, 등급)
- **자동 스코어링**: 각 항목 점수화 → 종합점수 → 순위
- 장단점 자동 분석
- 추천 코멘트

### 7. SMS 문자 발송 (알리고 API)

**설정 (⚙️ 설정탭):**
- 알리고 API Key, 사용자 ID, 발신번호 입력
- 테스트모드 Y/N 토글
- 가입: https://smartsms.aligo.in

**발송 흐름:**
1. 고객 목록에서 체크박스 선택 (or 상세에서 📩 클릭)
2. SMS 모달 열림
3. 템플릿 선택: 신규매물 안내 / 팔로업 / 이벤트·프로모션 / 직접입력
4. [이름] 변수 → 각 고객 이름으로 자동 치환
5. 발송 방법:
   - **📩 알리고 발송** (메인): API 직접 호출
   - 📱 문자앱: sms: URI scheme
   - 📋 복사: 클립보드

**알리고 API 스펙:**
- 1명: `POST https://apis.aligo.in/send/`
- 2~500명: `POST https://apis.aligo.in/send_mass/`
  - `rec_1`~`rec_500`, `msg_1`~`msg_500` (개별 메시지)
  - `cnt`: 발송 건수
- SMS/LMS 자동 판별 (45자 초과 시 LMS)
- `testmode_yn=Y`: 무과금 테스트
- `%고객명%` 치환 (알리고 자체) or 앱에서 [이름] 치환

**실발송 시 confirm 경고 필수.**

### 8. 대시보드

- KPI 카드: 고객 수, 점포 수, 브랜드 수
- 시세 KPI: ✅시세↓ N건 / ⚠️시세↑ N건
- 고객 파이프라인 (상태별 건수, 클릭 시 해당 필터로 이동)
- 점포 현황 (상태별 건수)
- 오늘 할 일 (팔로업 도래 고객/점포)
- 최근 활동

### 9. AI 프롬프트 생성

DB 데이터를 기반으로 AI 분석용 프롬프트 자동 생성:
- 🎯 고객-점포 매칭: 고객 조건 + 점포 목록 → 매칭 추천
- 📊 시장 인사이트: 전체 DB 통계 → 시장 분석
- ⚡ 오늘 할일: 팔로업 도래 + 미연락 고객 → 우선순위
- 📝 제안서 초안: 고객 조건 + 추천 점포 → 제안서

### 10. 엑셀 내보내기

- 고객 전체 / 선택 고객 엑셀
- 점포 전체 / 선택 점포 엑셀 (시세비교 컬럼 포함)
- 브랜드 연락처 엑셀
- 통합검색 결과 엑셀
- CSV 형식 (UTF-8 BOM)

### 11. 음성 입력

- Web Speech API (webkitSpeechRecognition)
- 한국어 인식 → 스마트 입력에 텍스트 추가
- 녹음 시작/중지 토글

---

## 🎨 UI/UX 설계

### 디자인 시스템
- 메인 컬러: `#C0392B` (레드)
- 배경: `#FAF9F6`
- 카드 배경: `#FFFFFF`
- 서브텍스트: `#888`
- 성공: `#2E7D32` (녹색)
- 경고: `#E65100` (주황)
- 폰트: `-apple-system, 'Pretendard', 'Noto Sans KR', sans-serif`
- 카드: `border-radius: 14px, box-shadow: 0 2px 12px rgba(0,0,0,0.06)`

### 네비게이션 (하단 탭)
7개 탭: 📊대시보드 | 📝통합입력 | 🔍검색 | 👥고객 | 🏪점포 | 🏷브랜드 | ⚙️설정

### 반응형 기준
- PC: `max-width: 900px`, 카드 내 `grid: r2(2열), r3(3열)`
- 모바일: 전체 1열, 폰트 약간 작게, 버튼 터치 최적화

### 뱃지 시스템
- 등급: VIP(빨강), 우수(주황), 신규(파랑)
- 상태: 신규(회색), 상담중(파랑), 계약(녹색), 보류(주황), 해지(빨강)
- 카테고리: 📂파란 뱃지 (#E3F2FD)
- 시세: ✅시세↓(녹색), ⚠️시세↑(주황)
- 활동: 3일내(녹색), 7일내(주황), 이상(빨강)

---

## 🔐 로그인/권한 (서버 신규)

### 사용자 테이블
```
users: id, username, password(hash), role, name, createdAt
role: 'admin' | 'staff'
```

### 권한 분리
| 기능 | admin (이사) | staff (직원) |
|------|-------------|-------------|
| 모든 CRUD | ✅ | ✅ |
| 삭제 | ✅ | ❌ |
| 설정 변경 | ✅ | ❌ |
| 카테고리 관리 | ✅ | ❌ |
| 알리고 설정 | ✅ | ❌ |
| 데이터 백업/복원 | ✅ | ❌ |
| 활동로그 열람 | ✅ | 본인만 |

---

## 📁 파일 시스템 (서버 신규)

### 파일 저장 구조
```
/uploads/
  /stores/{store_id}/
    photos/   → 점포 사진
    files/    → PDF, 워드, 한글 등
```

### 파일 업로드 API
- `POST /api/stores/{id}/files` → multipart/form-data
- 서버에서 파일 저장 → DB에 메타데이터 기록
- 용량 제한: 단일 50MB, 점포당 500MB

### 구글드라이브 연동 (향후)
- Google Drive API v3
- OAuth2 인증
- 점포별 자동 폴더 생성
- 파일 자동 업로드/분류

---

## 📡 API 설계 (서버 신규)

```
POST   /api/auth/login
POST   /api/auth/logout
GET    /api/auth/me

GET    /api/customers
POST   /api/customers
PUT    /api/customers/:id
DELETE /api/customers/:id

GET    /api/stores
POST   /api/stores
PUT    /api/stores/:id
DELETE /api/stores/:id
POST   /api/stores/:id/photos    (multipart)
POST   /api/stores/:id/files     (multipart)
DELETE /api/stores/:id/files/:fileId

GET    /api/brands
POST   /api/brands
PUT    /api/brands/:id
DELETE /api/brands/:id

GET    /api/categories
PUT    /api/categories

POST   /api/sms/send             (알리고 프록시)
GET    /api/sms/settings
PUT    /api/sms/settings

GET    /api/dashboard/stats
GET    /api/search?q=...&scope=...

POST   /api/export/customers     (엑셀)
POST   /api/export/stores        (엑셀)

GET    /api/settings
PUT    /api/settings
```

---

## 🛠 기술 스택 제안

| 영역 | 기술 | 이유 |
|------|------|------|
| 프론트엔드 | Next.js 14 (App Router) | SSR + 반응형 + 빠름 |
| UI | Tailwind CSS | 빠른 스타일링 |
| 백엔드 | Next.js API Routes | 풀스택 1개 |
| DB | PostgreSQL | 안정성, 무료 |
| ORM | Prisma | 타입 안전, 마이그레이션 |
| 인증 | NextAuth.js | 간단한 로그인 |
| 파일 | 서버 로컬 스토리지 | 초기 비용 0원 |
| 배포 | VPS (Ubuntu) | 월 3만원 |

---

## ⚠️ 중요 참고사항

1. **한글 금액 파싱**은 핵심 기능. "350만" → 3500000, "1억2천만" → 120000000 정확히 변환해야 함
2. **검색은 글자 하나라도 매치되면 결과에 포함** — 모든 필드 대상
3. **스마트 입력의 자동 분류 정확도**가 앱의 핵심 가치. 키워드 기반 분류 로직 정확히 이식
4. **[이름] 치환**: SMS 발송 시 각 고객별로 이름 자동 삽입
5. **시세 비교**: 임대료/보증금 각각 시세 입력 → 차이 금액 + 퍼센트 + 색상 표시
6. **updItem vs updItemR**: 텍스트 필드는 save만(연속입력 보장), select/date는 re-render
7. **첨부 HTML 파일 2개**에 모든 현재 기능이 구현되어 있음. 코드 참조하여 이식

---

## 📎 첨부 파일

1. `DB자동화.html` — PC 버전 (전체 기능)
2. `DB자동화_모바일.html` — 모바일 버전 (전체 기능)

이 두 파일의 JavaScript 로직을 서버 앱으로 이식하면 된다.
